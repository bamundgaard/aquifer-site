function formatRepoName(name){
  if(!name) return '';
  const short = name.split('/').pop();
  return short.replace(/([a-z])([A-Z])/g, '$1 $2').trim();
}

function renderLanding(manifest){
  MANIFEST = manifest; ALL_FILES = flattenAllFiles(MANIFEST);
  // Build repo cards with formatted names
  const cards = (MANIFEST.repos||[]).map((repo, i)=>{
    const langs = Object.keys(repo.languages||{});
    const count = langs.reduce((n, k)=> n + ((repo.languages[k]||[]).length), 0);
    const displayName = formatRepoName(repo.name);
    return `<div class="card">
      <h3>${displayName}</h3>
      <div class="muted">${langs.length} language${langs.length===1?'':'s'} â€¢ ${count} file${count===1?'':'s'}</div>
      <div style="margin-top:8px"><button class="btn" data-open-repo="${i}">Browse</button></div>
    </div>`;
  }).join('');
  $('langGrid').innerHTML = cards || `<div class="muted">No repositories found.</div>`;
  $('landing').classList.remove('hide'); $('files').classList.add('hide');
  $('foot').textContent = `Catalog generated ${manifest.generatedAt || ''}`;
  document.querySelectorAll('[data-open-repo]').forEach(b=> b.onclick = ()=> renderRepoLanguages(parseInt(b.dataset.openRepo,10)) );

  // Deep link: if #file present, open its repo/lang directly
  const wanted = getHash();
  if (wanted){
    const f = ALL_FILES.find(x=>x.path===wanted);
    if (f){
      const repoIdx = (MANIFEST.repos||[]).findIndex(r=> r.name === f.repo);
      if (repoIdx >= 0) renderFiles((MANIFEST.repos[repoIdx].languages[f.lang]||[]).map(x=>({...x, repo:f.repo, url:chooseUrl(x)})), f.lang, wanted, f.repo);
    }
  }
}
